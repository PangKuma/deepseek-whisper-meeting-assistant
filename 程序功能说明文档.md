# 会议助理项目 - Python程序功能说明文档

## 项目概述

这是一个基于Python的智能会议助理系统，能够自动处理会议录制的视频文件，完成从视频转录到会议纪要生成的完整工作流程。系统采用模块化设计，支持本地Whisper模型和AI大模型的深度集成。

## 程序文件功能详解

### 1. main.py - 主控制器程序

**文件位置**: `/main.py`
**核心功能**: 会议助理的中央调度器，控制整个自动化处理流程

#### 主要功能模块

1. **智能文件检测** (`wait_for_file_ready()`)
   - 监测文件大小变化，确保文件传输完成
   - 防止处理未完全写入的文件
   - 超时保护机制（最长等待5分钟）

2. **容错音频提取** (`extract_audio_with_retry()`)
   - 使用FFmpeg从视频中提取音频
   - 支持.mp4、.mov、.mkv、.webm格式
   - 最多重试5次的错误恢复机制
   - 输出格式：16kHz单声道MP3

3. **完整处理流水线** (`process_one_cycle()`)
   - Step 1: 视频 → 音频转换
   - Step 2: 音频 → 文字转录
   - Step 3: 文字 → AI总结生成
   - "阅后即焚"：自动删除中间临时文件

4. **批量任务管理**
   - 自动扫描`video_input`文件夹
   - 按文件名排序处理
   - 任务间隔冷却机制（5秒休息）

#### 目录结构
```
video_input/     # 视频文件输入目录
audio_input/     # 临时音频文件目录
text_output/     # 转录文本输出目录
```

### 2. transcribe_mlx.py - MLX优化转录模块

**文件位置**: `/transcribe_mlx.py`
**核心功能**: 基于MLX框架的高性能本地语音转录

#### 技术特点
- **本地模型**: 使用`./models/turbo-4bit`本地Whisper模型
- **MLX加速**: 专为Apple Silicon芯片优化的推理框架
- **中文优化**: 强制指定中文转录，适用于会议场景
- **内存管理**: 自动内存清理和垃圾回收

#### 配置参数
- 模型路径: `./models/turbo-4bit`
- 语言: 强制中文("zh")
- 初始提示: "这是一段中文会议记录，请使用简体中文转写"

#### 输入输出
- **输入**: 音频文件路径（支持mp3、wav、m4a）
- **输出**: 纯文本转录文件

### 3. transcribe.py - 通用转录模块

**文件位置**: `/transcribe.py`
**核心功能**: 基于faster-whisper的通用语音转录工具

#### 主要特点
- **跨平台支持**: CPU优化，兼容不同硬件环境
- **模型选择**: 可配置模型大小（small/medium/large-v3）
- **实时进度**: 显示转录时间轴和进度条
- **批量处理**: 自动扫描音频文件夹

#### 配置参数
- 模型大小: "small"（可调整为medium/large-v3）
- 设备: CPU（macOS M芯片优化）
- 计算类型: int8量化

#### 支持格式
- MP3, WAV, M4A音频文件

### 4. summarize.py - AI会议纪要生成模块

**文件位置**: `/summarize.py`
**核心功能**: 基于DeepSeek AI的智能会议纪要生成

#### 功能特色
- **AI驱动**: 使用DeepSeek-chat大语言模型
- **结构化输出**: 标准化会议纪要格式
- **上下文理解**: 智能提取关键信息
- **TODO识别**: 自动识别决议事项和待办任务

#### 输出格式
```markdown
# 会议纪要：{标题}
## 📌 一句话摘要
## 👥 关键议题与讨论
## ✅ 决议与待办 (TODO)
## 💡 详细内容记录
```

#### 配置要求
- 需要设置`DEEPSEEK_API_KEY`环境变量
- API端点: https://api.deepseek.com
- 温度参数: 0.3（保证输出稳定性）
- 最大令牌: 4000

### 5. convert.py - 模型格式转换工具

**文件位置**: `/convert.py`
**核心功能**: 将Hugging Face模型转换为MLX兼容格式

#### 转换流程
1. 读取`model.safetensors`文件
2. 转换为MLX优化的`weights.npz`格式
3. 保持模型权重完整性

#### 使用场景
- 用于MLX-whisper模型的本地部署
- 一次性转换工具，非日常使用

## 工作流程整合

### 完整自动化流程

```
视频文件输入
    ↓
[FFmpeg] 音频提取
    ↓
[MLX-Whisper] 语音转录
    ↓
[DeepSeek AI] 智能总结
    ↓
[Obsidian] 会议纪要存储
```

### 文件流转机制

1. **输入监控**: 实时检测`video_input`目录新文件
2. **智能等待**: 文件大小稳定后才开始处理
3. **清理机制**: 每个步骤完成后自动删除中间文件
4. **错误恢复**: 多级重试和异常处理

## 依赖和环境要求

### 核心依赖
- `faster-whisper`: 通用语音识别
- `mlx-whisper`: Apple Silicon优化转录
- `openai`: AI对话接口
- `python-dotenv`: 环境变量管理
- `ffmpeg`: 音视频处理工具

### 硬件要求
- **推荐**: Apple Silicon Mac（M1/M2/M3）
- **最低**: 支持Python 3.9+的任何系统
- **存储**: 需要空间存放Whisper本地模型

## 配置说明

### 环境变量配置
```bash
DEEPSEEK_API_KEY=your_api_key_here
```

### 目录路径配置
```python
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
VIDEO_FOLDER = os.path.join(BASE_DIR, "video_input")
AUDIO_FOLDER = os.path.join(BASE_DIR, "audio_input")
TEXT_FOLDER = os.path.join(BASE_DIR, "text_output")
SUMMARY_FOLDER = "/Users/yangjuncheng/Documents/Obsidian Vault/Meetings"
```

## 使用建议

1. **首次使用**: 先运行`convert.py`转换模型格式
2. **批量处理**: 将多个视频文件放入`video_input`目录
3. **单文件测试**: 可单独调用各模块功能
4. **性能优化**: 根据设备性能调整模型大小
5. **存储管理**: 定期清理临时文件和输出目录

## 总结

这个会议助理系统实现了从视频录制到结构化会议纪要的全流程自动化，特别适合需要频繁整理会议记录的办公场景。系统采用模块化设计，易于维护和扩展，同时具备良好的错误处理和性能优化。